<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù¾ÛŒÚ¯ÛŒØ±ÛŒâ€ŒÙ‡Ø§ÛŒ ØªÛŒÙ… Ø§Ø±Ø¯Ø± Ú©Ø± â€” NFC Order Care (single-file)</title>
<style>
  :root{--pink:#ff0a7a;--ink:#0f172a;--bg:#f5f7fb;--rail:#e48abb;--soft:rgba(17,24,39,.08);--r-lg:28px;--r-sm:18px}
  *{box-sizing:border-box;font-family:system-ui,'Segoe UI',Tahoma,Arial,sans-serif}
  body{margin:0;color:var(--ink);
       background:radial-gradient(1400px 520px at 50% -160px,#ff4aa0 0%,transparent 60%),
                  linear-gradient(#fff 0,#fff 160px,var(--bg) 260px)}
  .brand{position:fixed;top:14px;right:22px;z-index:30;color:#fff;background:linear-gradient(90deg,#ff0a7a,#ff4aa0);
         padding:10px 16px;border-radius:999px;font-weight:900;font-size:clamp(20px,3.4vw,32px);box-shadow:0 10px 22px rgba(0,0,0,.14)}
  .controls{position:fixed;top:18px;left:22px;z-index:30;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .selector{background:#fff;border:1px solid #ffe1f0;border-radius:999px;padding:8px 12px;display:flex;gap:10px;align-items:center;box-shadow:0 8px 18px rgba(0,0,0,.06)}
  .selector label{font-weight:900;color:var(--pink)}
  .selector select{border:none;outline:none;background:transparent;font-weight:900;color:var(--pink);cursor:pointer}
  .title-wrap{padding-top:86px;text-align:center;color:#fff;text-shadow:0 4px 18px rgba(0,0,0,.25)}
  .title{font-weight:900;font-size:clamp(18px,3vw,26px);margin:0}
  .subtitle{opacity:.95;font-weight:700;margin-top:6px;font-size:clamp(12px,2vw,15px)}

  .wrap{width:100%;margin:16px auto 0}
  .rail-shell{background:rgba(255,255,255,.82);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.8);
              border-radius:var(--r-lg);box-shadow:0 14px 36px var(--soft);margin:0 auto;width:min(95vw,2000px);padding:18px;overflow-x:auto}
  .rail{display:flex;flex-direction:row;align-items:flex-start;gap:18px;min-height:300px;padding-bottom:36px}

  .step{display:flex;flex-direction:column;min-width:280px;max-width:360px;transition:.25s}
  .step.past{min-width:230px;max-width:260px;opacity:.9}
  .card{background:#fff;border-radius:var(--r-sm);border:2px solid transparent;box-shadow:0 16px 34px var(--soft)}
  .card.active{border-color:var(--pink);box-shadow:0 0 0 6px rgba(255,10,122,.12),0 18px 40px rgba(0,0,0,.12)}
  .card.past{transform:scale(.94)}

  .head{display:flex;align-items:center;gap:12px;padding:16px 16px 10px;cursor:pointer}
  .icon{width:64px;height:64px;border-radius:16px;background:radial-gradient(circle at 30% 30%,#ffd1ea,#ff9bd0);
        display:grid;place-items:center;font-size:34px;box-shadow:inset 0 0 0 2px #fff,0 10px 24px rgba(255,10,122,.18)}
  .kicker{font-size:12px;color:#64748b;margin-bottom:6px;font-weight:800}
  .h3{margin:0;font-size:16px;line-height:1.7;font-weight:900}
  .caret{margin-inline-start:auto;opacity:.8;transition:.2s}
  .step.open .caret{transform:rotate(180deg)}
  .body{display:none;padding:0 16px 16px}
  .step.open .body{display:block}
  .hr{height:1px;background:#f1f5f9;margin:0 16px 12px}

  .opts{display:flex;flex-direction:column;gap:10px;margin-top:10px}
  .opt{display:flex;align-items:center;gap:10px;background:#fff;border:1px solid #ffe0ef;border-radius:14px;padding:12px 14px;
       box-shadow:0 10px 22px rgba(255,10,122,.10);cursor:pointer;transition:.2s;font-weight:800}
  .opt:hover{border-color:var(--pink);transform:translateY(-2px);box-shadow:0 12px 26px rgba(255,10,122,.18)}
  .opt b{color:var(--pink)}
  .opt small{font-size:12px;color:#475569;margin-right:auto}
  .opt .arr{margin-right:4px}
  .arr{display:inline-block;transform:translateY(-1px)}

  .connector{width:90px;position:relative;display:flex;align-items:center;justify-content:center;margin-top:36px}
  .connector::before{content:"";width:100%;height:3px;background:linear-gradient(270deg,#ffd1ea,var(--rail))}
  .connector::after{content:"";position:absolute;left:-4px;border-top:7px solid transparent;border-bottom:7px solid transparent;border-right:9px solid var(--rail)}

  .bench{display:flex;justify-content:center;gap:10px;margin:14px auto 30px}
  .btn{background-image:linear-gradient(to top,#ff0a7a,#ff4aa0);border:none;color:#fff;padding:12px 18px;border-radius:999px;font-weight:900;cursor:pointer}
  .btn:disabled{background:#cbd5e1}
  .zoom{display:flex;gap:8px;align-items:center}
  .zoom input{accent-color:var(--pink)}

  /* Ù¾Ù†Ù„ Ù…Ø­Ø§Ø³Ø¨Ø§ØªÛŒ */
  .calc{background:#fff7fb;border:1px solid #ffd6ea;border-radius:14px;padding:12px;margin-top:10px}
  .calc .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .calc label{font-weight:800;font-size:12px;color:#334155}
  .calc input{width:100%;padding:10px;border:1px solid #ffd1ea;border-radius:10px;outline:none}
  .calc .out{margin-top:10px;background:#f8fbff;border:1px solid #dbeafe;border-radius:10px;padding:10px;font-weight:800}
  .calc .hint{font-size:12px;color:#64748b;margin-top:6px}
  .calc .actions{display:flex;gap:10px;margin-top:10px;justify-content:flex-start}
</style>
</head>
<body>
  <div class="brand">Ù¾ÛŒÚ¯ÛŒØ±ÛŒâ€ŒÙ‡Ø§ÛŒ ØªÛŒÙ… Ø§Ø±Ø¯Ø± Ú©Ø±</div>

  <div class="controls">
    <div class="selector">
      <label>Ø±ÛŒØ²Ù†/ÙÙ„Ùˆ:</label>
      <select id="reason">
        <option value="pre_assign">Ù¾ÛŒØ´â€ŒÙÙ„Ùˆ: Ø§Ø³Ø§ÛŒÙ† / Ú†Ú© Ù„ÛŒØ¨Ù„</option>
        <option value="address_issue">Ø¢Ø¯Ø±Ø³ Ù…Ø´ØªØ±ÛŒ Ù†Ø§Ù‚Øµ/Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª</option>
        <option value="cannot_follow_note">Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø´ØªØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</option>
        <option value="delay">Ø²Ù…Ø§Ù† Ø§Ø±Ø³Ø§Ù„/Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯</option>
        <option value="no_show_customer">Ù…Ø´ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ­ÙˆÛŒÙ„ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ù†Ú©Ø±Ø¯Ù†Ø¯</option>
        <option value="weight_change">ØªØºÛŒÛŒØ± ÙˆØ²Ù† Ù…Ø­ØµÙˆÙ„</option>
        <option value="mismatch">Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ù…ØºØ§ÛŒØ±Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡</option>
        <option value="no_courier">Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ù¾ÛŒÚ© Ù…Ø¬Ù…ÙˆØ¹Ù‡/Ø§Ú©Ø³Ù¾Ø±Ø³</option>
        <option value="ship_fee">ØªØºÛŒÛŒØ± Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´</option>
        <option value="duplicate">Ø³ÙØ§Ø±Ø´ ØªÚ©Ø±Ø§Ø±ÛŒ Ø§Ø³Øª</option>
        <option value="address_far">Ø¢Ø¯Ø±Ø³ Ø®ÛŒÙ„ÛŒ Ø¯ÙˆØ± Ø§Ø³Øª</option>
        <option value="sys_issue">Ø³ÛŒØ³ØªÙ… Ø³ÙØ§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ø¯</option>
        <option value="busy_weather">Ø´Ù„ÙˆØºÛŒ/Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§</option>
        <option value="only_app">ÙÙ‚Ø· Ù¾ÛŒØ´â€ŒØºØ°Ø§</option>
        <option value="temp_closed">Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù…ÙˆÙ‚ØªØ§ Ø¨Ø³ØªÙ‡ Ø§Ø³Øª</option>
        <option value="tech_issue">Ù…Ø´Ú©Ù„ ÙÙ†ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡</option>
      </select>
    </div>
    <button class="selector" id="resetBtn" type="button">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
  </div>

  <div class="title-wrap">
    <h1 class="title" id="mainTitle">Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÛŒØ²Ù†/ÙÙ„Ùˆ</h1>
    <div class="subtitle" id="subtitle">Ù†Ø³Ø®Ù‡Ù” ØªÚ©â€ŒÙØ§ÛŒÙ„Ù‡Ø› Ø§Ú¯Ø± ÙÙˆÙ†Øª Snapp Ù„ÙˆØ¯ Ù†Ø´Ø¯ØŒ Ø¸Ø§Ù‡Ø± Ú©Ù…ÛŒ ÙØ±Ù‚ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ ÙˆÙ„ÛŒ Ú©Ø§Ø±Ú©Ø±Ø¯ Ú©Ø§Ù…Ù„ Ø§Ø³Øª.</div>
  </div>

  <div class="wrap">
    <div class="rail-shell"><div id="rail" class="rail" aria-live="polite"></div></div>
    <div class="bench">
      <button class="btn" id="prev" type="button">Ù…Ø±Ø­Ù„Ù‡ Ù‚Ø¨Ù„</button>
      <div class="zoom"><span style="color:#fff">Ø¨Ø²Ø±Ú¯â€ŒÙ†Ù…Ø§ÛŒÛŒ</span>
        <input id="zoom" type="range" min="80" max="140" value="100">
      </div>
    </div>
  </div>

<script>
const ARROW='âŸµ';

/* â€”â€”â€” Flows (Ù…Ù‡Ù…: Ù‡Ù…Ù‡Ù” Ú©Ù„ÛŒØ¯Ù‡Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù†Ø¯ ØªØ§ Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø¨Ø§Ø² Ø´Ø¯Ù† Ù†Ø¨Ø§Ø´Ø¯) â€”â€”â€” */

/* 0) Pre-assign */
const FLOW_PRE_ASSIGN={start:{id:'start',text:'ÙØ§Ú©ØªÙˆØ± Ø§Ø³Ø§ÛŒÙ† Ø´Ø¯',icon:'ğŸ•’',next:'label_check'},
label_check:{id:'label_check',text:'Ú†Ú© Ù„ÛŒØ¨Ù„ ÙØ§Ú©ØªÙˆØ±',icon:'âœ…',branches:[
{label:'Ø¨Ø¯ÙˆÙ† Ù„ÛŒØ¨Ù„ (Ûµ Ø³ÙØ§Ø±Ø´ Ø§Ø®ÛŒØ± Ø±Ø§ Ú†Ú© Ú©Ù†)',target:'no_label_recent'},
{label:'Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´',target:'registered_label'},
{label:'Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³',target:'need_contact_label'}]},
no_label_recent:{id:'no_label_recent',text:'Ûµ Ø³ÙØ§Ø±Ø´ Ø§Ø®ÛŒØ± â€“ ÙˆØ¶Ø¹ÛŒØª Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ',icon:'âœ…',branches:[
{label:'Ø§Ø±Ø³Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ø±Ø³ØªÙˆØ±Ø§Ù† (Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´)',target:'recent_sent'},
{label:'Ø±Ø³ÛŒØ¯Ù‡ Ø¨Ù‡ Ø¯Ø³Øª Ø±Ø³ØªÙˆØ±Ø§Ù† (VMS Delay)',target:'recent_vms'},
{label:'Ø¨Ø¯Ø³Øª Ø±Ø³ØªÙˆØ±Ø§Ù† Ù†Ø±Ø³ÛŒØ¯Ù‡ (Ù…Ø«Ù„ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´)',target:'recent_not_reached'}]},
recent_sent:{id:'recent_sent',text:'Ù…Ø«Ù„ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ â†’ Ù…Ø³ÛŒØ± Â«Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´Â»',icon:'ğŸ·ï¸',next:'registered_label'},
recent_not_reached:{id:'recent_not_reached',text:'Ù…Ø«Ù„ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ â†’ Ù…Ø³ÛŒØ± Â«Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´Â»',icon:'ğŸ·ï¸',next:'registered_label'},
recent_vms:{id:'recent_vms',text:'VMS Delay â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡',icon:'ğŸª',branches:[
{label:'Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ø¯ â†’ Ø·Ø¨Ù‚ Ø±ÛŒØ²Ù†â€ŒÙ‡Ø§ÛŒ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ',target:'go_reasons'},
{label:'Ù…Ø´Ú©Ù„ Ù†Ø¯Ø§Ø±Ø¯',target:'end'}]},
registered_label:{id:'registered_label',text:'Ù„ÛŒØ¨Ù„ Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´',icon:'ğŸ·ï¸',branches:[
{label:'Ø¨Ø§Ø²Ø®ÙˆØ§Ù†ÛŒ/ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ/Ø¨Ø³ØªÙ† Ùˆ Ø¨Ø§Ø²Ú©Ø±Ø¯Ù†/Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª',target:'refresh_steps'},
{label:'Ø§Ú¯Ø± Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³ Ø´Ø¯ â†’ Ø¹Ù„Øª Ø±Ø§ Ø¨Ù¾Ø±Ø³',target:'need_contact_label'}]},
refresh_steps:{id:'refresh_steps',text:'Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø³ÙØ§Ø±Ø´ Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡',icon:'âœ…',next:'end'},
need_contact_label:{id:'need_contact_label',text:'Ù„ÛŒØ¨Ù„ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³ â†’ Ø¹Ù„Øª Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†',icon:'â“',next:'go_reasons'},
go_reasons:{id:'go_reasons',text:'Ø±ÙØªÙ† Ø¨Ù‡ Ø±ÛŒØ²Ù†â€ŒÙ‡Ø§',icon:'âœ…',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 1) Address issue */
const FLOW_ADDRESS_ISSUE={start:{id:'start',text:'Ø¢Ø¯Ø±Ø³ Ù…Ø´ØªØ±ÛŒ Ù†Ø§Ù‚Øµ ÛŒØ§ Ø§Ø´ØªØ¨Ø§Ù‡ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø³Øª',icon:'âš ï¸',next:'pay_type'},
pay_type:{id:'pay_type',text:'Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ú†Ú© Ú©Ù†',icon:'âœ…',branches:[
{label:'ØºÛŒØ±Ù†Ù‚Ø¯ÛŒ (Ø¢Ù†Ù„Ø§ÛŒÙ†)',target:'label_online'},
{label:'Ù†Ù‚Ø¯ÛŒ',target:'issue_cash'}]},
label_online:{id:'label_online',text:'Ù„ÛŒØ¨Ù„ Ø³ÙØ§Ø±Ø´ Ú†ÛŒØ³ØªØŸ',icon:'âœ…',branches:[
{label:'Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³',target:'online_call_nc'},
{label:'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³',target:'online_call_approved'}]},
online_call_nc:{id:'online_call_nc',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ (Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³)',icon:'â˜ï¸',branches:[
{label:'Ù¾Ø§Ø³Ø®Ú¯Ùˆ Ù†ÛŒØ³Øª â†’ Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´',target:'online_nc_no_answer_cancel'},
{label:'Ù¾Ø§Ø³Ø®Ú¯Ùˆ Ø§Ø³Øª â†’ Ø¯Ø±ÛŒØ§ÙØª Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚',target:'online_get_address'}]},
online_nc_no_answer_cancel:{id:'online_nc_no_answer_cancel',text:'Ø¹Ø¯Ù… Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ â†’ Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´',icon:'â›”',next:'end'},
online_call_approved:{id:'online_call_approved',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ (ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³)',icon:'â˜ï¸',branches:[
{label:'Ù¾Ø§Ø³Ø®Ú¯Ùˆ Ù†ÛŒØ³Øª',target:'check_vendor_cancel'},
{label:'Ù¾Ø§Ø³Ø®Ú¯Ùˆ Ø§Ø³Øª â†’ Ø¯Ø±ÛŒØ§ÙØª Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚',target:'online_get_address'}]},
check_vendor_cancel:{id:'check_vendor_cancel',text:'Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù…Ú©Ø§Ù† Ú©Ù†Ø³Ù„ÛŒ Ø§Ø² Ù…Ø¬Ù…ÙˆØ¹Ù‡',icon:'ğŸª',branches:[
{label:'ØªØ£ÛŒÛŒØ¯ â†’ Ú©Ù†Ø³Ù„ÛŒ',target:'online_cancel'},
{label:'Ø¹Ø¯Ù… ØªØ£ÛŒÛŒØ¯ â†’ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ ØªØ§ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù…Ø´ØªØ±ÛŒ',target:'hold_at_vendor'}]},
online_cancel:{id:'online_cancel',text:'Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´ (Ø¨Ø§ ØªØ§ÛŒÛŒØ¯ Ù…Ø¬Ù…ÙˆØ¹Ù‡)',icon:'â›”',next:'end'},
hold_at_vendor:{id:'hold_at_vendor',text:'Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø³ÙØ§Ø±Ø´ Ø¯Ø± Ù…Ø¬Ù…ÙˆØ¹Ù‡ ØªØ§ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù…Ø´ØªØ±ÛŒ',icon:'ğŸª',next:'end'},
online_get_address:{id:'online_get_address',text:'Ú¯Ø±ÙØªÙ† Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚ Ùˆ Ø«Ø¨Øª Ø¯Ø± ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø³Ù†Ù¾â€ŒÙÙˆØ¯',icon:'ğŸ–Šï¸',next:'profile_fix'},
issue_cash:{id:'issue_cash',text:'Ù†ÙˆØ¹ Ù…Ø´Ú©Ù„ Ø¢Ø¯Ø±Ø³ (Ø³ÙØ§Ø±Ø´ Ù†Ù‚Ø¯ÛŒ)',icon:'â“',branches:[
{label:'Ø¢Ø¯Ø±Ø³ Ù†Ø§Ù‚Øµ (Ù¾Ù„Ø§Ú©/ÙˆØ§Ø­Ø¯/Ú©Ø±ÙˆÚ©ÛŒâ€¦)',target:'cash_call_record'},
{label:'Ù…Ú©Ø§Ù† Ø¹Ù…ÙˆÙ…ÛŒ',target:'cancel_public_place'}]},
cash_call_record:{id:'cash_call_record',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ùˆ Ø«Ø¨Øª Ø¢Ø¯Ø±Ø³ Ø¯Ø± ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø³Ù†Ù¾â€ŒÙÙˆØ¯',icon:'â˜ï¸',next:'profile_fix'},
cancel_public_place:{id:'cancel_public_place',text:'Ù…Ú©Ø§Ù† Ø¹Ù…ÙˆÙ…ÛŒ â†’ Ù¾Ø±ÙˆØ³Ù‡ Ú©Ù†Ø³Ù„ÛŒ + ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ',icon:'ğŸ¤–',next:'end'},
profile_fix:{id:'profile_fix',text:'ØªÚ©Ù…ÛŒÙ„ Ù†Ø§Ù…/Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ùˆ Ø«Ø¨Øª Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¯Ø± Â«Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†Â» Ù¾Ø±ÙˆÙØ§ÛŒÙ„',icon:'ğŸ–Šï¸',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 2) Cannot follow note */
const FLOW_CANNOT_NOTE={start:{id:'start',text:'Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø´ØªØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯',icon:'âš ï¸',next:'vendor_told'},
vendor_told:{id:'vendor_told',text:'Ø¢ÛŒØ§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù…Ø´Ú©Ù„ Ø±Ø§ Ø§Ø¹Ù„Ø§Ù… Ú©Ø±Ø¯Ù‡ØŸ',icon:'âœ…',branches:[
{label:'Ø®ÛŒØ±ØŒ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡',target:'call_vendor'},
{label:'Ø¨Ù„Ù‡ØŒ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ',target:'cust_choice'}]},
call_vendor:{id:'call_vendor',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø¬Ù‡Øª Ø¨Ø±Ø±Ø³ÛŒ',icon:'ğŸª',next:'cust_choice'},
cust_choice:{id:'cust_choice',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ùˆ ØªØµÙ…ÛŒÙ…',icon:'â˜ï¸',branches:[
{label:'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯',target:'send_wo'},
{label:'Ù‡Ø²ÛŒÙ†Ù‡ Ø¯Ø§Ø±Ø¯ Ùˆ Ù…Ø´ØªØ±ÛŒ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ø¯',target:'delta'},
{label:'Ù†Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ø¯ Ùˆ Ú©Ù†Ø³Ù„ÛŒ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯',target:'cancel'}]},
send_wo:{id:'send_wo',text:'Ø«Ø¨Øª Ù…ØªÙ† Ø¯Ø± ØªÙˆØ¶ÛŒØ­Ø§Øª Ø³ÙØ§Ø±Ø´ + Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',icon:'ğŸ§¾',next:'end'},
delta:{id:'delta',text:'Ù¾Ø±ÙˆØ³Ù‡ Ø¯Ù„ØªØ§',icon:'ğŸ§¾',next:'end'},
cancel:{id:'cancel',text:'Ù¾Ø±ÙˆØ³Ù‡ Ú©Ù†Ø³Ù„ÛŒ',icon:'â›”',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 3) Delay (with calculator in approved-need-contact) */
const FLOW_DELAY={start:{id:'start',text:'Ø²Ù…Ø§Ù† Ø§Ø±Ø³Ø§Ù„/Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯',icon:'ğŸ•’',next:'label_kind'},
label_kind:{id:'label_kind',text:'Ù†ÙˆØ¹ Ù„ÛŒØ¨Ù„ Ú†ÛŒØ³ØªØŸ',icon:'âœ…',branches:[
{label:'Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³ (Ù…Ø¹Ù…ÙˆÙ„ÛŒ)',target:'courier'},
{label:'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³ (Ø¨Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡Ù” Ø²Ù…Ø§Ù†)',target:'calc_delay'}]},
courier:{id:'courier',text:'Ù†ÙˆØ¹ Ù¾ÛŒÚ©ØŸ',icon:'ğŸšš',branches:[
{label:'Ø§Ú©Ø³Ù¾Ø±Ø³',target:'exp_time'},
{label:'Ù¾ÛŒÚ© Ø±Ø³ØªÙˆØ±Ø§Ù†',target:'res_time'}]},
exp_time:{id:'exp_time',text:'Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ (Ø§Ú©Ø³Ù¾Ø±Ø³)',icon:'â±ï¸',branches:[
{label:'Û°â€“Û´Û° â†’ Ø§ØµÙ„Ø§Ø­ ÙØ§Ú©ØªÙˆØ±',target:'invoice'},
{label:'Û´Û°â€“Û±Û²Û° â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ',target:'call'},
{label:'Û±Û²Û°+ â†’ Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ',target:'autocancel'}]},
res_time:{id:'res_time',text:'Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ (Ø±Ø³ØªÙˆØ±Ø§Ù†)',icon:'â±ï¸',branches:[
{label:'Û°â€“Û·Û° â†’ Ø§ØµÙ„Ø§Ø­ ÙØ§Ú©ØªÙˆØ±',target:'invoice'},
{label:'Û·Û°â€“Û±Û²Û° â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ',target:'call'},
{label:'Û±Û²Û°+ â†’ Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ',target:'autocancel'}]},
calc_delay:{id:'calc_delay',text:'Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø§Ø¹Ù„Ø§Ù… Ø²Ù…Ø§Ù† Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ',icon:'â±ï¸'},
approved_call_vendor:{id:'approved_call_vendor',text:'(Ø¹Ø¨ÙˆØ± Ø§Ø² Ø²Ù…Ø§Ù† Ø§ØµÙ„ÛŒ) ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ùˆ Ø§Ø¹Ù„Ø§Ù… Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Â«Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡Â»',icon:'â˜ï¸',next:'end'},
approved_call_customer:{id:'approved_call_customer',text:'(Ø¹Ø¨ÙˆØ± Ù†Ú©Ø±Ø¯Ù‡) ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ùˆ Ø§Ø¹Ù„Ø§Ù… Â«Ø²Ù…Ø§Ù† Ù†Ù‡Ø§ÛŒÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒØ´Ø¯Ù‡Ù” Ø³ÛŒØ³ØªÙ…Â»',icon:'â˜ï¸',next:'end'},
call:{id:'call',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ',icon:'ğŸ‘¤',next:'end'},
invoice:{id:'invoice',text:'Ø§ØµÙ„Ø§Ø­ ÙØ§Ú©ØªÙˆØ±',icon:'ğŸ§¾',next:'end'},
autocancel:{id:'autocancel',text:'Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ',icon:'ğŸ¤–',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 4) No-show customer */
const FLOW_NO_SHOW={start:{id:'start',text:'Ù…Ø´ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ­ÙˆÛŒÙ„ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ù†Ú©Ø±Ø¯Ù†Ø¯',icon:'âš ï¸',next:'call'},
call:{id:'call',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ',icon:'â˜ï¸',branches:[
{label:'Ù¾Ø§Ø³Ø®Ú¯Ùˆ Ù†ÛŒØ³Øª â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',target:'call_vendor'},
{label:'Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ø¯ â†’ Ø«Ø¨Øª Ù…ÙˆØ±Ø¯ Ùˆ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',target:'accept'},
{label:'Ù†Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ø¯ â†’ ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø­Ø¶ÙˆØ±ÛŒ',target:'convince'}]},
call_vendor:{id:'call_vendor',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',icon:'ğŸª',next:'end'},
accept:{id:'accept',text:'Ø«Ø¨Øª Ù…ÙˆØ±Ø¯ Ø§Ø¹Ù„Ø§Ù…ÛŒ Ù…Ø´ØªØ±ÛŒ + Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',icon:'ğŸ–Šï¸',next:'end'},
convince:{id:'convince',text:'Ù…ØªÙ‚Ø§Ø¹Ø¯Ø³Ø§Ø²ÛŒ ØªØ­ÙˆÛŒÙ„ Ø­Ø¶ÙˆØ±ÛŒ',icon:'ğŸ‘¤',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 5) Weight change */
const FLOW_WEIGHT={start:{id:'start',text:'ØªØºÛŒÛŒØ± ÙˆØ²Ù† Ù…Ø­ØµÙˆÙ„',icon:'ğŸ·ï¸',next:'desc'},
desc:{id:'desc',text:'ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ú©Ø§Ù…Ù„ Ø§Ø³ØªØŸ',icon:'âœ…',branches:[
{label:'Ú©Ø§Ù…Ù„ Ø§Ø³Øª',target:'check'},
{label:'Ù†Ø§Ù‚Øµ Ø§Ø³Øª â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡',target:'check'}]},
check:{id:'check',text:'Ú†Ú© Ù‚ÛŒÙ…Øª Ùˆ ÙˆØ²Ù†',icon:'âš–ï¸',branches:[
{label:'Ú©Ù…ØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯ â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ',target:'less'},
{label:'Ø¨ÛŒØ´ØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯ â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ',target:'more'}]},
less:{id:'less',text:'Ù¾Ø§Ø³Ø® Ù…Ø´ØªØ±ÛŒØŸ',icon:'âš–ï¸',branches:[
{label:'Ù…ÙˆØ±Ø¯ ØªØ£ÛŒÛŒØ¯ Ù‡Ø³Øª â†’ Ø«Ø¨Øª Ø¯Ø± ØªÙˆØ¶ÛŒØ­Ø§Øª',target:'log'},
{label:'Ù…ÙˆØ±Ø¯ ØªØ£ÛŒÛŒØ¯ Ù†ÛŒØ³Øª â†’ Ú©Ù†Ø³Ù„ÛŒ',target:'cancel'}]},
more:{id:'more',text:'Ù¾Ø§Ø³Ø® Ù…Ø´ØªØ±ÛŒØŸ',icon:'âš–ï¸',branches:[
{label:'Ù…ÙˆØ±Ø¯ ØªØ£ÛŒÛŒØ¯ Ù‡Ø³Øª â†’ Ø¯Ù„ØªØ§',target:'delta'},
{label:'Ù…ÙˆØ±Ø¯ ØªØ£ÛŒÛŒØ¯ Ù†ÛŒØ³Øª â†’ Ú©Ù†Ø³Ù„ÛŒ',target:'cancel'}]},
log:{id:'log',text:'Ø«Ø¨Øª Ø¯Ø± ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø³Ù†Ù¾â€ŒÙÙˆØ¯',icon:'ğŸ–Šï¸',next:'end'},
delta:{id:'delta',text:'Ù¾Ø±ÙˆØ³Ù‡ Ø¯Ù„ØªØ§',icon:'ğŸ§¾',next:'end'},
cancel:{id:'cancel',text:'Ù¾Ø±ÙˆØ³Ù‡ Ú©Ù†Ø³Ù„ÛŒ',icon:'â›”',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 6) Mismatch */
const FLOW_MISMATCH={start:{id:'start',text:'Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ù…ØºØ§ÛŒØ±Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡',icon:'âš ï¸',next:'courier'},
courier:{id:'courier',text:'Ù¾ÛŒÚ© Ø³ÙØ§Ø±Ø´ Ú†ÛŒØ³ØªØŸ',icon:'ğŸšš',branches:[
{label:'Ø§Ú©Ø³Ù¾Ø±Ø³ / Ø§Ú©Ø³Ù¾Ø±Ø³ Ù¾Ù„Ø§Ø³',target:'vendor_desc'},
{label:'Ù¾ÛŒÚ© Ù…Ø¬Ù…ÙˆØ¹Ù‡',target:'vendor_courier'}]},
vendor_desc:{id:'vendor_desc',text:'ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ú©Ø§Ù…Ù„ Ø§Ø³ØªØŸ',icon:'âœ…',branches:[
{label:'Ú©Ø§Ù…Ù„ â†’ Ø«Ø¨Øª ØªÛŒÚ©Øª + Ø«Ø¨Øª Ù…ØªÙ† + Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',target:'ticket_send'},
{label:'Ù†Ø§Ù‚Øµ â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ â†’ Ø«Ø¨Øª ØªÛŒÚ©Øª + Ø«Ø¨Øª Ù…ØªÙ† + Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',target:'call_then_ticket'}]},
ticket_send:{id:'ticket_send',text:'Ø«Ø¨Øª ØªÛŒÚ©Øª + Ø«Ø¨Øª ØªÙˆØ¶ÛŒØ­Ø§Øª + Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',icon:'ğŸ§¾',next:'end'},
call_then_ticket:{id:'call_then_ticket',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ â†’ Ø«Ø¨Øª ØªÛŒÚ©Øª + Ø«Ø¨Øª ØªÙˆØ¶ÛŒØ­Ø§Øª + Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',icon:'ğŸª',next:'end'},
vendor_courier:{id:'vendor_courier',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ùˆ ØªØµÙ…ÛŒÙ…',icon:'â˜ï¸',branches:[
{label:'Ø§ØµÙ„Ø§Ø­ (Ø¹ÙˆØ¯Øª Ù…Ø§Ø¨Ù‡â€ŒØ§Ù„ØªÙØ§ÙˆØª Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„)',target:'adjust_wallet'},
{label:'Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´',target:'cancel'},
{label:'Ø§Ø±Ø³Ø§Ù„ ØµØ­ÛŒØ­ Ø³ÙØ§Ø±Ø´',target:'correct_flow'}]},
adjust_wallet:{id:'adjust_wallet',text:'Ø§ØµÙ„Ø§Ø­ ÙØ§Ú©ØªÙˆØ± + Ø¹ÙˆØ¯Øª Ù…Ø§Ø¨Ù‡â€ŒØ§Ù„ØªÙØ§ÙˆØª',icon:'ğŸ§¾',next:'end'},
correct_flow:{id:'correct_flow',text:'Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø² Ù…Ø¬Ù…ÙˆØ¹Ù‡',icon:'ğŸª',branches:[
{label:'Ù…ÙˆØ¬ÙˆØ¯ â†’ Ø§Ø±Ø³Ø§Ù„ Ùˆ Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ',target:'send_and_inform'},
{label:'Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ùˆ Ø§ØµÙ„Ø§Ø­/Ú©Ù†Ø³Ù„ÛŒ',target:'call_modify_or_cancel'}]},
send_and_inform:{id:'send_and_inform',text:'Ø§Ø±Ø³Ø§Ù„ ØµØ­ÛŒØ­ Ùˆ Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ',icon:'âœ‰ï¸',next:'end'},
call_modify_or_cancel:{id:'call_modify_or_cancel',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ â†’ Ø§ØµÙ„Ø§Ø­ ÛŒØ§ Ú©Ù†Ø³Ù„ÛŒ',icon:'â˜ï¸',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 7) No courier */
const FLOW_NO_COURIER={start:{id:'start',text:'Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ù¾ÛŒÚ© Ù…Ø¬Ù…ÙˆØ¹Ù‡ / Ø§Ú©Ø³Ù¾Ø±Ø³',icon:'âš ï¸',next:'courier'},
courier:{id:'courier',text:'Ù¾ÛŒÚ© Ø³ÙØ§Ø±Ø´ØŸ',icon:'ğŸšš',branches:[
{label:'Ù¾ÛŒÚ© Ù…Ø¬Ù…ÙˆØ¹Ù‡',target:'vendor_absent'},
{label:'Ø§Ú©Ø³Ù¾Ø±Ø³ / Ø§Ú©Ø³Ù¾Ø±Ø³ Ù¾Ù„Ø§Ø³',target:'express_absent'}]},
vendor_absent:{id:'vendor_absent',text:'Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ (Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ù¾ÛŒÚ© Ù…Ø¬Ù…ÙˆØ¹Ù‡)',icon:'ğŸ¤–',next:'end'},
express_absent:{id:'express_absent',text:'Ø¢Ø±Ø´ÛŒÙˆ ØªØ§Ø®ÛŒØ±Ù‡Ø§ Ø±Ø§ Ú†Ú© Ú©Ù†',icon:'âœ…',branches:[
{label:'Ù‡Ø§ÛŒÙ¾Ø± Ø¯ÛŒÙ„ÛŒ Ù†ÛŒØ³Øª â†’ Ø«Ø¨Øª ØªÙˆØ¶ÛŒØ­ + Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',target:'note_fix'},
{label:'Ù‡Ø§ÛŒÙ¾Ø± Ø¯ÛŒÙ„ÛŒ Ø§Ø³Øª',target:'hyper_call_vendor'}]},
note_fix:{id:'note_fix',text:'Ø«Ø¨Øª Ù…ØªÙ† Ø¯Ø± ØªÙˆØ¶ÛŒØ­Ø§Øª + Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',icon:'ğŸ§¾',next:'end'},
hyper_call_vendor:{id:'hyper_call_vendor',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡: Ø¨Ø§ Ù¾ÛŒÚ© Ø®ÙˆØ¯Ø´Ø§Ù† Ù…ÛŒâ€ŒÙØ±Ø³ØªÙ†Ø¯ØŸ',icon:'ğŸª',branches:[
{label:'Ø¨Ù„Ù‡ â†’ ØªØºÛŒÛŒØ± Ø¨Ù‡ Ù¾ÛŒÚ© Ù…Ø¬Ù…ÙˆØ¹Ù‡ + Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',target:'switch_vendor_send'},
{label:'Ø®ÛŒØ± â†’ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ù†Ø³Ù„ÛŒØŸ',target:'ask_cancel'}]},
switch_vendor_send:{id:'switch_vendor_send',text:'ØªØºÛŒÛŒØ± Ø¨Ù‡ Ù¾ÛŒÚ© Ù…Ø¬Ù…ÙˆØ¹Ù‡ + Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',icon:'ğŸ§¾',next:'end'},
ask_cancel:{id:'ask_cancel',text:'Ø§Ú¯Ø± Ø¨Ù„Ù‡ â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ùˆ Ú©Ù†Ø³Ù„ÛŒ / Ø§Ú¯Ø± Ù†Ù‡ â†’ Ø§Ø·Ù„Ø§Ø¹ Ø¨Ø±Ø§ÛŒ ØµØ¨ÙˆØ±ÛŒ',icon:'â˜ï¸',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 8) Ship fee */
const FLOW_SHIP_FEE={start:{id:'start',text:'ØªØºÛŒÛŒØ± Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´',icon:'ğŸ·ï¸',next:'is_lower'},
is_lower:{id:'is_lower',text:'Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ú©Ù…ØªØ± Ø´Ø¯Ù‡ØŸ',icon:'â“',branches:[
{label:'Ø¨Ù„Ù‡ â†’ Ø§ØµÙ„Ø§Ø­ Ù‡Ø²ÛŒÙ†Ù‡ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',target:'lower_fix'},
{label:'Ø®ÛŒØ± (Ø¨ÛŒØ´ØªØ± Ø´Ø¯Ù‡)',target:'who_fault'}]},
lower_fix:{id:'lower_fix',text:'Ø§ØµÙ„Ø§Ø­ Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ + Ø§Ø±Ø³Ø§Ù„ Ø§ØµÙ„Ø§Ø­ÛŒÙ‡',icon:'ğŸ§¾',next:'end'},
who_fault:{id:'who_fault',text:'Ø®Ø·Ø§ Ø§Ø² Ø³Ù…Øª Ú†Ù‡ Ú©Ø³ÛŒ Ø§Ø³ØªØŸ',icon:'âœ…',branches:[
{label:'Ù…Ø´ØªØ±ÛŒ â†’ Ø¯Ù„ØªØ§',target:'delta'},
{label:'Ù…Ø¬Ù…ÙˆØ¹Ù‡/Ø§Ø³Ù†Ù¾â€ŒÙÙˆØ¯ â†’ Ø§Ù‚Ù†Ø§Ø¹/Ù¾ÛŒÚ¯ÛŒØ±ÛŒ',target:'convince'}]},
delta:{id:'delta',text:'Ø¯Ù„ØªØ§ (Ù¾Ø±Ø¯Ø§Ø®Øª/Ø¯Ø±ÛŒØ§ÙØª Ù…Ø§Ø¨Ù‡â€ŒØ§Ù„ØªÙØ§ÙˆØª)',icon:'ğŸ§¾',next:'end'},
convince:{id:'convince',text:'Ø§Ú¯Ø± Ù‚Ø§Ù†Ø¹ Ù†Ø´Ø¯Ù†Ø¯: Ø²ÛŒØ±Ø¯Ù„Ø§ÛŒÙ„ Ø®Ø³Ø§Ø±Øª/Ø§Ø±Ø¬Ø§Ø¹ Ø¨Ù‡ Ø³Ø±Ú¯Ø±ÙˆÙ‡',icon:'â“',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 9) Duplicate */
const FLOW_DUPLICATE={start:{id:'start',text:'Ø³ÙØ§Ø±Ø´ ØªÚ©Ø±Ø§Ø±ÛŒ Ø§Ø³Øª',icon:'âš ï¸',next:'promo'},
promo:{id:'promo',text:'Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ú©Ø¯ ØªØ®ÙÛŒÙ Ø«Ø¨Øª Ø´Ø¯Ù‡ØŸ',icon:'â“',branches:[
{label:'Ø¨Ù„Ù‡',target:'call_vendor_block'},
{label:'Ø®ÛŒØ±',target:'check_log'}]},
call_vendor_block:{id:'call_vendor_block',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ùˆ Ø§Ø¹Ù„Ø§Ù… Ø¹Ø¯Ù… Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ + Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø³Ø±Ú¯Ø±ÙˆÙ‡',icon:'ğŸª',next:'end'},
check_log:{id:'check_log',text:'Ø«Ø¨Øª ØªÙ…Ø§Ø³ Ø±Ø§ Ø¨Ø±Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨ÙˆØ¯Ù† Ú†Ú© Ú©Ù†',icon:'âœ…',branches:[
{label:'ØªÚ©Ø±Ø§Ø±ÛŒ Ù†ÛŒØ³Øª â†’ Ø«Ø¨Øª Â«ØªÚ©Ø±Ø§Ø±ÛŒ Ù†ÛŒØ³ØªÂ»',target:'not_dup_note'},
{label:'ØªÚ©Ø±Ø§Ø±ÛŒ Ø§Ø³Øª â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ',target:'call_customer'}]},
not_dup_note:{id:'not_dup_note',text:'Ø«Ø¨Øª Â«ØªÚ©Ø±Ø§Ø±ÛŒ Ù†ÛŒØ³ØªÂ» Ø¯Ø± ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø³Ù†Ù¾â€ŒÙÙˆØ¯',icon:'ğŸ–Šï¸',next:'end'},
call_customer:{id:'call_customer',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ',icon:'â˜ï¸',branches:[
{label:'Ù‡Ø± Ø¯Ùˆ Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ø¯ â†’ Ø«Ø¨Øª',target:'both_note'},
{label:'Ø§Ø´ØªØ¨Ø§Ù‡ Ø´Ø¯Ù‡ â†’ Ú©Ù†Ø³Ù„ÛŒ',target:'cancel'}]},
both_note:{id:'both_note',text:'Ø«Ø¨Øª Ø®ÙˆØ§Ø³Øª Ù…Ø´ØªØ±ÛŒ (Ù‡Ø± Ø¯Ùˆ) Ø¯Ø± ØªÙˆØ¶ÛŒØ­Ø§Øª',icon:'ğŸ–Šï¸',next:'end'},
cancel:{id:'cancel',text:'Ù¾Ø±ÙˆØ³Ù‡ Ú©Ù†Ø³Ù„ÛŒ',icon:'â›”',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 10) Address far */
const FLOW_ADDRESS_FAR={start:{id:'start',text:'Ø¢Ø¯Ø±Ø³ Ø®ÛŒÙ„ÛŒ Ø¯ÙˆØ± Ø§Ø³Øª',icon:'âš ï¸',next:'label'},
label:{id:'label',text:'Ù„ÛŒØ¨Ù„ Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ú†Ú© Ú©Ù†',icon:'âœ…',branches:[
{label:'Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³ â†’ Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ',target:'autocancel'},
{label:'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªÙ…Ø§Ø³',target:'approved'}]},
autocancel:{id:'autocancel',text:'Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ',icon:'ğŸ¤–',next:'end'},
approved:{id:'approved',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡: Ø¨Ø§ Ù…Ø¨Ù„Øº Ø¨ÛŒØ´ØªØ± Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯ØŸ',icon:'ğŸª',branches:[
{label:'Ø¨Ù„Ù‡ â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ùˆ Ø¯Ù„ØªØ§',target:'delta_call'},
{label:'Ø®ÛŒØ± â†’ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ØªØ­ÙˆÛŒÙ„ Ø­Ø¶ÙˆØ±ÛŒ',target:'pickup_offer'}]},
delta_call:{id:'delta_call',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ù…Ø¨Ù„Øº Ø§Ø¶Ø§ÙÛŒ (Ø¯Ù„ØªØ§)',icon:'â˜ï¸',next:'end'},
pickup_offer:{id:'pickup_offer',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ØªØ­ÙˆÛŒÙ„ Ø­Ø¶ÙˆØ±ÛŒ',icon:'â˜ï¸',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* 11..15) Ø³ÛŒØ³ØªÙ…/Ø´Ù„ÙˆØºÛŒ/ÙÙ‚Ø· Ù¾ÛŒØ´â€ŒØºØ°Ø§/Ù…ÙˆÙ‚ØªØ§ Ø¨Ø³ØªÙ‡/Ù…Ø´Ú©Ù„ ÙÙ†ÛŒ */
const FLOW_SYS_ISSUE={start:{id:'start',text:'Ø³ÛŒØ³ØªÙ… Ø³ÙØ§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ø¯',icon:'âš ï¸',next:'call_vendor'},
call_vendor:{id:'call_vendor',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ùˆ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø·Ø¨Ù‚ Ø¯Ø±Ø®ÙˆØ§Ø³Øª',icon:'ğŸª',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};
const FLOW_BUSY_WEATHER={start:{id:'start',text:'Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø´Ù„ÙˆØºÛŒ / Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§ Ø§Ù…Ú©Ø§Ù† Ø§Ø±Ø³Ø§Ù„ Ù†ÛŒØ³Øª',icon:'âš ï¸',next:'autocancel'},
autocancel:{id:'autocancel',text:'Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ',icon:'ğŸ¤–',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};
const FLOW_ONLY_APP={start:{id:'start',text:'Ù…Ø´ØªØ±ÛŒ ÙÙ‚Ø· Ù¾ÛŒØ´â€ŒØºØ°Ø§ Ø³ÙØ§Ø±Ø´ Ø¯Ø§Ø¯Ù‡',icon:'âš ï¸',next:'check_items'},
check_items:{id:'check_items',text:'Â«Ø¨Ø±Ù†Ø¬Â» ÛŒØ§ Â«Ø³Ø§Ù„Ø§Ø¯ Ø³Ø²Ø§Ø±Â» Ø¯Ø§Ø±Ø¯ØŸ',icon:'â“',branches:[
{label:'Ø¨Ù„Ù‡ â†’ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡',target:'call_vendor'},
{label:'Ø®ÛŒØ± â†’ Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ',target:'autocancel'}]},
call_vendor:{id:'call_vendor',text:'ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø¬Ù…ÙˆØ¹Ù‡ (Ø§Ø³Ú©Ø±ÛŒÙ¾Øª)',icon:'ğŸª',next:'end'},
autocancel:{id:'autocancel',text:'Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ',icon:'ğŸ¤–',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};
const FLOW_TEMP_CLOSED={start:{id:'start',text:'Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù…ÙˆÙ‚ØªØ§Ù‹ Ø¨Ø³ØªÙ‡ Ø§Ø³Øª',icon:'âš ï¸',next:'autocancel'},
autocancel:{id:'autocancel',text:'Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ',icon:'ğŸ¤–',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};
const FLOW_TECH_ISSUE={start:{id:'start',text:'Ù…Ø´Ú©Ù„ ÙÙ†ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡ (Ø¨Ø±Ù‚/Ú¯Ø§Ø²/â€¦)',icon:'âš ï¸',next:'autocancel'},
autocancel:{id:'autocancel',text:'Ø§ØªÙˆÚ©Ø§Ù„ Ú©Ù†Ø³Ù„ÛŒ',icon:'ğŸ¤–',next:'end'},
end:{id:'end',text:'Ù¾Ø§ÛŒØ§Ù†',icon:'ğŸ'}};

/* Map */
const FLOWS={
  pre_assign:{title:'Ù¾ÛŒØ´â€ŒÙÙ„Ùˆ: Ø§Ø³Ø§ÛŒÙ† / Ú†Ú© Ù„ÛŒØ¨Ù„',flow:FLOW_PRE_ASSIGN},
  address_issue:{title:'Ø¢Ø¯Ø±Ø³ Ù…Ø´ØªØ±ÛŒ Ù†Ø§Ù‚Øµ/Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª',flow:FLOW_ADDRESS_ISSUE},
  cannot_follow_note:{title:'Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø´ØªØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯',flow:FLOW_CANNOT_NOTE},
  delay:{title:'Ø²Ù…Ø§Ù† Ø§Ø±Ø³Ø§Ù„/Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯',flow:FLOW_DELAY},
  no_show_customer:{title:'Ù…Ø´ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ­ÙˆÛŒÙ„ Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ù†Ú©Ø±Ø¯Ù†Ø¯',flow:FLOW_NO_SHOW},
  weight_change:{title:'ØªØºÛŒÛŒØ± ÙˆØ²Ù† Ù…Ø­ØµÙˆÙ„',flow:FLOW_WEIGHT},
  mismatch:{title:'Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ù…ØºØ§ÛŒØ±Øª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡',flow:FLOW_MISMATCH},
  no_courier:{title:'Ø¹Ø¯Ù… Ø­Ø¶ÙˆØ± Ù¾ÛŒÚ© Ù…Ø¬Ù…ÙˆØ¹Ù‡/Ø§Ú©Ø³Ù¾Ø±Ø³',flow:FLOW_NO_COURIER},
  ship_fee:{title:'ØªØºÛŒÛŒØ± Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´',flow:FLOW_SHIP_FEE},
  duplicate:{title:'Ø³ÙØ§Ø±Ø´ ØªÚ©Ø±Ø§Ø±ÛŒ Ø§Ø³Øª',flow:FLOW_DUPLICATE},
  address_far:{title:'Ø¢Ø¯Ø±Ø³ Ø®ÛŒÙ„ÛŒ Ø¯ÙˆØ± Ø§Ø³Øª',flow:FLOW_ADDRESS_FAR},
  sys_issue:{title:'Ø³ÛŒØ³ØªÙ… Ø³ÙØ§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ø¯',flow:FLOW_SYS_ISSUE},
  busy_weather:{title:'Ø´Ù„ÙˆØºÛŒ/Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§',flow:FLOW_BUSY_WEATHER},
  only_app:{title:'ÙÙ‚Ø· Ù¾ÛŒØ´â€ŒØºØ°Ø§',flow:FLOW_ONLY_APP},
  temp_closed:{title:'Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù…ÙˆÙ‚ØªØ§ Ø¨Ø³ØªÙ‡ Ø§Ø³Øª',flow:FLOW_TEMP_CLOSED},
  tech_issue:{title:'Ù…Ø´Ú©Ù„ ÙÙ†ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡',flow:FLOW_TECH_ISSUE}
};
</script>

<script>
/* â€”â€”â€” Renderer & calculator logic â€”â€”â€” */
const rail=document.getElementById('rail');
const reasonSel=document.getElementById('reason');
const prevBtn=document.getElementById('prev');
const resetBtn=document.getElementById('resetBtn');
const titleEl=document.getElementById('mainTitle');
const subtitleEl=document.getElementById('subtitle');
let ACTIVE=null; const trail=[];

function byId(id){ return ACTIVE[id]; }
function toMin(hhmm){ if(!hhmm) return NaN; const parts=hhmm.split(':'); if(parts.length<2) return NaN; const h=+parts[0], m=+parts[1]; if(isNaN(h)||isNaN(m)) return NaN; return h*60+m; }

window.__calcCompute = function(idx){
  const c = document.getElementById('calc-'+idx);
  if(!c) return;
  const tConfirm = toMin(c.querySelector('.t-confirm').value);
  const tAssign  = toMin(c.querySelector('.t-assign').value);
  const tMain    = parseInt(c.querySelector('.t-main').value,10);
  const tVendor  = parseInt(c.querySelector('.t-vendor').value,10);
  const out = c.querySelector('.out');
  const goBtn = c.querySelector('.goBtn');
  if([tConfirm,tAssign,tMain,tVendor].some(x=>isNaN(x))){
    out.textContent = 'ÙˆØ±ÙˆØ¯ÛŒ Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª. Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ù†ÛŒØ¯.'; goBtn.disabled=true; return;
  }
  let elapsed = tAssign - tConfirm;
  if(elapsed<0) elapsed += 24*60; // Ø¹Ø¨ÙˆØ± Ø§Ø² Ù†ÛŒÙ…Ù‡â€ŒØ´Ø¨
  if(elapsed > tMain){
    out.textContent = 'âœ… Ø¹Ø¨ÙˆØ± Ø§Ø² Ø²Ù…Ø§Ù† Ø§ØµÙ„ÛŒ. Ù…Ø³ÛŒØ±: Â«Ø§Ø¹Ù„Ø§Ù… Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒÂ». Ø²Ù…Ø§Ù† Ø§Ø¹Ù„Ø§Ù…ÛŒ: '+tVendor+' Ø¯Ù‚ÛŒÙ‚Ù‡.';
    goBtn.dataset.target = 'approved_call_vendor';
    goBtn.disabled=false;
  } else {
    const finalMin = (tMain - elapsed) + tVendor;
    out.textContent = 'âœ… Ø¹Ø¨ÙˆØ± Ù†Ú©Ø±Ø¯Ù‡. Ø²Ù…Ø§Ù† Ù†Ù‡Ø§ÛŒÛŒ Ø§Ø¹Ù„Ø§Ù… Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ: '+finalMin+' Ø¯Ù‚ÛŒÙ‚Ù‡.';
    goBtn.dataset.target = 'approved_call_customer';
    goBtn.dataset.final = finalMin;
    goBtn.disabled=false;
  }
};
window.__calcProceed = function(idx){
  const c = document.getElementById('calc-'+idx);
  const target = (c.querySelector('.goBtn').dataset.target)||'approved_call_customer';
  go(target, idx);
};

function makeStep(entry,i,isCurrent){
  const s=byId(entry.id);
  const step=document.createElement('div');
  step.className='step'+(i<trail.length-1?' past':'')+(i===trail.length-1?' open':'');
  const card=document.createElement('div');card.className='card'+(isCurrent?' active':'')+(i<trail.length-1?' past':'');
  const head=document.createElement('div'); head.className='head';
  head.innerHTML=`<div class="icon">${s.icon||'ğŸ”·'}</div>
  <div><div class="kicker">Ù…Ø±Ø­Ù„Ù‡ ${i+1}</div><h3 class="h3">${s.text}</h3></div><span class="caret">âŒ„</span>`;
  head.addEventListener('click',()=>step.classList.toggle('open'));
  card.appendChild(head);

  const body=document.createElement('div'); body.className='body';
  body.appendChild(Object.assign(document.createElement('div'),{className:'hr'}));

  if(s.id==='calc_delay'){
    const c=document.createElement('div'); c.className='calc'; c.id='calc-'+i;
    c.innerHTML=`
      <div class="row">
        <div><label>Ø²Ù…Ø§Ù† ØªØ£ÛŒÛŒØ¯ ÙØ§Ú©ØªÙˆØ± (HH:MM)</label><input class="t-confirm" type="time" required></div>
        <div><label>Ø²Ù…Ø§Ù† Ø§Ø³Ø§ÛŒÙ†/Ø³ÛŒØ³ØªÙ… (HH:MM)</label><input class="t-assign" type="time" required></div>
      </div>
      <div class="row">
        <div><label>Ø²Ù…Ø§Ù† Ø§ØµÙ„ÛŒ ÙØ§Ú©ØªÙˆØ±/Ø§Ø±Ø³Ø§Ù„ (Ø¯Ù‚ÛŒÙ‚Ù‡)</label><input class="t-main" type="number" min="0" step="1" placeholder="Ù…Ø«Ù„Ø§Ù‹ 60"></div>
        <div><label>Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡ (Ø¯Ù‚ÛŒÙ‚Ù‡)</label><input class="t-vendor" type="number" min="0" step="1" placeholder="Ù…Ø«Ù„Ø§Ù‹ 30"></div>
      </div>
      <div class="actions">
        <button class="btn" type="button" onclick="__calcCompute(${i})">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
        <button class="btn goBtn" type="button" disabled onclick="__calcProceed(${i})">Ø§Ø¯Ø§Ù…Ù‡</button>
      </div>
      <div class="out">Ù†ØªÛŒØ¬Ù‡Ù” Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
      <div class="hint">Ø§Ú¯Ø± (Ø§Ø³Ø§ÛŒÙ† âˆ’ ØªØ£ÛŒÛŒØ¯) > Â«Ø²Ù…Ø§Ù† Ø§ØµÙ„ÛŒÂ»ØŒ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Â«Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡Â» Ø§Ø¹Ù„Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯. ÙˆÚ¯Ø±Ù†Ù‡: Â«(Ø²Ù…Ø§Ù† Ø§ØµÙ„ÛŒ âˆ’ ÙØ§ØµÙ„Ù‡ ØªØ§ÛŒÛŒØ¯ ØªØ§ Ø§Ø³Ø§ÛŒÙ†) + Ø²Ù…Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡Â» Ø§Ø¹Ù„Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
    `;
    body.appendChild(c);
  } else if(s.branches){
    const opts=document.createElement('div'); opts.className='opts';
    s.branches.forEach(b=>{
      const o=document.createElement('div'); o.className='opt';
      o.innerHTML=`<b>${b.label}</b><small>Ø§Ù†ØªØ®Ø§Ø¨ <span class="arr">${ARROW}</span></small>`;
      o.addEventListener('click',()=>go(b.target,i));
      opts.appendChild(o);
    });
    body.appendChild(opts);
  } else if(s.next){
    const btn=document.createElement('button'); btn.className='opt';
    btn.innerHTML=`<b>Ø§Ø¯Ø§Ù…Ù‡</b><small>Continue <span class="arr">${ARROW}</span></small>`;
    btn.addEventListener('click',()=>go(s.next,i));
    body.appendChild(btn);
  }

  card.appendChild(body); step.appendChild(card); return step;
}

function render(){
  rail.innerHTML='';
  trail.forEach((e,i)=>{
    rail.appendChild(makeStep(e,i,i===trail.length-1));
    if(i<trail.length-1){
      const c=document.createElement('div'); c.className='connector'; rail.appendChild(c);
    }
  });
  prevBtn.disabled = trail.length<=1;
  // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø±Ø§Ø³Øª (Ø´Ø±ÙˆØ¹) Ú©Ù‡ Ù…Ø±Ø­Ù„Ù‡Ù” Ø¬Ø¯ÛŒØ¯ Ø³Ù…Øª Ø±Ø§Ø³Øª Ø¯ÛŒØ¯Ù‡ Ø´ÙˆØ¯
  rail.parentElement.scrollTo({left:0,behavior:'smooth'});
}

function go(target,fromIndex){ trail.splice(fromIndex+1); trail.push({id:target}); render(); }

function initFlow(key){
  const cfg=FLOWS[key];
  if(!cfg){ console.warn('Flow not found', key); return; }
  ACTIVE=cfg.flow;
  titleEl.textContent=cfg.title;
  subtitleEl.textContent='Â«'+cfg.title+'Â»';
  trail.length=0;
  trail.push({id:'start'});
  const n=ACTIVE.start && ACTIVE.start.next;
  if(n) trail.push({id:n});
  render();
}

/* hooks */
reasonSel.addEventListener('change',e=>initFlow(e.target.value));
prevBtn.addEventListener('click',()=>{ if(trail.length>1){ trail.pop(); render(); }});
resetBtn.addEventListener('click',()=>initFlow(reasonSel.value));
document.getElementById('zoom').addEventListener('input',e=>{
  const v=e.target.value; rail.style.transform=`scale(${v/100})`; rail.style.transformOrigin='center left';
});

/* boot */
initFlow(reasonSel.value);
</script>
</body>
</html>
